-- MM2 Hub with Key System
local correctKey = "Mm2025" -- MM2 key

-- Services
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- Global flag for key authentication
local keyAuthentication = {
    passed = false,
    attempts = 0,
    maxAttempts = 5,
    locked = false
}

-- Function to kick player
local function kickPlayer(reason)
    if LocalPlayer and LocalPlayer.Kick then
        LocalPlayer:Kick("MM2 Hub: " .. reason)
    else
        game:Shutdown()
    end
end

-- Create secure key UI
local function createKeyGUI()
    local keyGui = Instance.new("ScreenGui")
    keyGui.Name = "MM2Hub_KeySystem"
    keyGui.ResetOnSpawn = false
    keyGui.Parent = CoreGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 400, 0, 300) -- Increased height for Discord button
    frame.Position = UDim2.new(0.5, -200, 0.5, -150)
    frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    frame.BorderSizePixel = 0
    frame.Parent = keyGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = frame

    -- Title with MM2 theme
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 50)
    title.Position = UDim2.new(0, 0, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = "🔪 MM2 Hub Access"
    title.TextColor3 = Color3.fromRGB(220, 220, 220)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 24
    title.Parent = frame

    -- Discord button
    local discordButton = Instance.new("TextButton")
    discordButton.Size = UDim2.new(0.8, 0, 0, 40)
    discordButton.Position = UDim2.new(0.1, 0, 0.2, 0)
    discordButton.Text = "📢 Join Discord Server for Key"
    discordButton.Font = Enum.Font.GothamBold
    discordButton.TextSize = 14
    discordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242) -- Discord blue
    discordButton.TextColor3 = Color3.new(1, 1, 1)
    discordButton.Parent = frame
    
    local discordCorner = Instance.new("UICorner")
    discordCorner.CornerRadius = UDim.new(0, 8)
    discordCorner.Parent = discordButton

    local discordDesc = Instance.new("TextLabel")
    discordDesc.Size = UDim2.new(0.8, 0, 0, 30)
    discordDesc.Position = UDim2.new(0.1, 0, 0.3, 0)
    discordDesc.BackgroundTransparency = 1
    discordDesc.Text = "Link copied to clipboard: discord.gg/9BDbbzWQKV"
    discordDesc.TextColor3 = Color3.fromRGB(180, 180, 180)
    discordDesc.TextSize = 11
    discordDesc.Font = Enum.Font.Gotham
    discordDesc.TextWrapped = true
    discordDesc.Parent = frame

    local warningLabel = Instance.new("TextLabel")
    warningLabel.Size = UDim2.new(0.9, 0, 0, 30)
    warningLabel.Position = UDim2.new(0.05, 0, 0.45, 0)
    warningLabel.BackgroundTransparency = 1
    warningLabel.Text = "⚠️ 5 wrong attempts = auto-kick"
    warningLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
    warningLabel.TextSize = 12
    warningLabel.Font = Enum.Font.Gotham
    warningLabel.Parent = frame

    local textbox = Instance.new("TextBox")
    textbox.Size = UDim2.new(0.9, 0, 0, 45)
    textbox.Position = UDim2.new(0.05, 0, 0.6, 0)
    textbox.PlaceholderText = "Enter access key..."
    textbox.Text = ""
    textbox.Font = Enum.Font.Gotham
    textbox.TextSize = 16
    textbox.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    textbox.TextColor3 = Color3.new(1, 1, 1)
    textbox.ClearTextOnFocus = false
    
    local textCorner = Instance.new("UICorner")
    textCorner.CornerRadius = UDim.new(0, 8)
    textCorner.Parent = textbox
    textbox.Parent = frame

    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, 0, 0, 25)
    statusLabel.Position = UDim2.new(0, 0, 0.75, 0)
    statusLabel.BackgroundTransparency = 1
    statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    statusLabel.Text = ""
    statusLabel.TextSize = 14
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.Parent = frame

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.7, 0, 0, 40)
    button.Position = UDim2.new(0.15, 0, 0.85, 0)
    button.Text = "🔑 Submit Key"
    button.Font = Enum.Font.GothamBold
    button.TextSize = 16
    button.BackgroundColor3 = Color3.fromRGB(170, 0, 0) -- Red MM2 theme
    button.TextColor3 = Color3.new(1, 1, 1)
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = button
    button.Parent = frame

    -- Discord button functionality
    discordButton.MouseButton1Click:Connect(function()
        pcall(function()
            setclipboard("https://discord.gg/9BDbbzWQKV")
        end)
        
        -- Visual feedback
        discordButton.Text = "✅ Link Copied!"
        discordButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        
        task.wait(1.5)
        
        discordButton.Text = "📢 Join Discord Server for Key"
        discordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    end)

    -- Submit handler
    local function handleSubmit()
        if keyAuthentication.locked then
            statusLabel.Text = "🔒 System locked - kicking..."
            return
        end

        local inputKey = textbox.Text
        if inputKey == correctKey then
            keyAuthentication.passed = true
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            statusLabel.Text = "✅ Access granted!"
            button.Text = "🎉 Loading MM2 Hub..."
            button.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
            
            -- Smooth fade out
            local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            
            TweenService:Create(frame, tweenInfo, {BackgroundTransparency = 1}):Play()
            TweenService:Create(textbox, tweenInfo, {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(button, tweenInfo, {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(title, tweenInfo, {TextTransparency = 1}):Play()
            TweenService:Create(statusLabel, tweenInfo, {TextTransparency = 1}):Play()
            TweenService:Create(warningLabel, tweenInfo, {TextTransparency = 1}):Play()
            TweenService:Create(discordButton, tweenInfo, {BackgroundTransparency = 1, TextTransparency = 1}):Play()
            TweenService:Create(discordDesc, tweenInfo, {TextTransparency = 1}):Play()
            
            task.wait(0.6)
            if keyGui then
                keyGui:Destroy()
            end
        else
            keyAuthentication.attempts = keyAuthentication.attempts + 1
            statusLabel.Text = string.format("❌ Invalid key! (%d/%d)", keyAuthentication.attempts, keyAuthentication.maxAttempts)
            textbox.Text = ""
            
            if keyAuthentication.attempts >= 3 then
                button.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
            end
            
            if keyAuthentication.attempts >= keyAuthentication.maxAttempts then
                keyAuthentication.locked = true
                statusLabel.Text = "🚫 Maximum attempts reached!"
                button.Text = "🔴 Kicking..."
                button.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                
                task.wait(2)
                kickPlayer("Too many failed key attempts")
            end
        end
    end

    button.MouseButton1Click:Connect(handleSubmit)
    textbox.FocusLost:Connect(function(enterPressed)
        if enterPressed then handleSubmit() end
    end)

    textbox:CaptureFocus()
    return keyGui
end

-- Wait for key authentication
local keyGui = createKeyGUI()
local startTime = tick()

repeat
    if keyAuthentication.locked then break end
    task.wait(0.1)
until keyAuthentication.passed or (tick() - startTime) > 300

if not keyAuthentication.passed then
    if keyGui then keyGui:Destroy() end
    if not keyAuthentication.locked then
        kickPlayer("Key authentication timeout")
    end
    return
end

-- ===== MM2 HUB MAIN GUI =====
local UserInputService = game:GetService("UserInputService")
local mm2HubGui = Instance.new("ScreenGui")
mm2HubGui.Name = "MM2Hub"
mm2HubGui.ResetOnSpawn = false
mm2HubGui.Parent = CoreGui

-- Main frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 450, 0, 550) -- Increased height
mainFrame.Position = UDim2.new(0.02, 0, 0.02, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = mm2HubGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 60)
title.Position = UDim2.new(0, 0, 0, 10)
title.BackgroundTransparency = 1
title.Text = "🔪 MM2 Hub"
title.TextColor3 = Color3.fromRGB(220, 220, 220)
title.Font = Enum.Font.GothamBold
title.TextSize = 28
title.Parent = mainFrame

-- Subtle divider
local divider = Instance.new("Frame")
divider.Size = UDim2.new(1, -40, 0, 2)
divider.Position = UDim2.new(0, 20, 0, 70)
divider.BackgroundColor3 = Color3.fromRGB(70, 70, 90)
divider.BorderSizePixel = 0
divider.BackgroundTransparency = 0.5
divider.Parent = mainFrame
local dividerCorner = Instance.new("UICorner")
dividerCorner.CornerRadius = UDim.new(0, 2)
dividerCorner.Parent = divider

-- Scrolling frame for buttons
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -20, 1, -100)
scrollFrame.Position = UDim2.new(0, 10, 0, 80)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 650)
scrollFrame.Parent = mainFrame

-- UIListLayout for buttons
local uiListLayout = Instance.new("UIListLayout")
uiListLayout.Padding = UDim.new(0, 10)
uiListLayout.Parent = scrollFrame

-- MM2 Functions
local function crashAllPlayers()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            pcall(function()
                local character = player.Character
                if character then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid.Health = 0
                    end
                end
            end)
        end
    end
end

local function hostageAllPlayers()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            pcall(function()
                local character = player.Character
                if character then
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        humanoidRootPart.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, -5)
                    end
                end
            end)
        end
    end
end

local function freezeAllPlayers()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            pcall(function()
                local character = player.Character
                if character then
                    local humanoid = character:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid.PlatformStand = true
                    end
                end
            end)
        end
    end
end

local function unfreezeAllPlayers()
    for _, player in pairs(Players:GetPlayers()) do
        pcall(function()
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.PlatformStand = false
                end
            end
        end)
    end
end

local function getMurderer()
    for _, player in pairs(Players:GetPlayers()) do
        pcall(function()
            local character = player.Character
            if character and character:FindFirstChild("Knife") then
                return player
            end
        end)
    end
    return nil
end

local function getSheriff()
    for _, player in pairs(Players:GetPlayers()) do
        pcall(function()
            local character = player.Character
            if character and character:FindFirstChild("Gun") then
                return player
            end
        end)
    end
    return nil
end

local function copyMurdererName()
    local murderer = getMurderer()
    if murderer then
        pcall(function()
            setclipboard(tostring(murderer.Name))
        end)
        return murderer.Name
    end
    return nil
end

local function copySheriffName()
    local sheriff = getSheriff()
    if sheriff then
        pcall(function()
            setclipboard(tostring(sheriff.Name))
        end)
        return sheriff.Name
    end
    return nil
end

local function freezeMurdererInFront()
    local murderer = getMurderer()
    if murderer and murderer.Character and LocalPlayer.Character then
        pcall(function()
            local murdererHRP = murderer.Character:FindFirstChild("HumanoidRootPart")
            local localHRP = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if murdererHRP and localHRP then
                -- Freeze murderer
                local humanoid = murderer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.PlatformStand = true
                end
                
                -- Position murderer in front of player
                murdererHRP.CFrame = localHRP.CFrame * CFrame.new(0, 0, -5) * CFrame.Angles(0, math.rad(180), 0)
            end
        end)
    end
end

-- Create buttons for each feature
local function createButton(text, description, callback, color)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, -10, 0, 80)
    buttonFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    buttonFrame.BorderSizePixel = 0
    buttonFrame.Parent = scrollFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = buttonFrame
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 50)
    button.Position = UDim2.new(0, 0, 0, 0)
    button.BackgroundColor3 = color or Color3.fromRGB(170, 0, 0)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Text = text
    button.Font = Enum.Font.GothamBold
    button.TextSize = 16
    button.BorderSizePixel = 0
    button.Parent = buttonFrame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = button
    
    local descLabel = Instance.new("TextLabel")
    descLabel.Size = UDim2.new(1, -10, 0, 20)
    descLabel.Position = UDim2.new(0, 5, 0, 55)
    descLabel.BackgroundTransparency = 1
    descLabel.Text = description
    descLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    descLabel.Font = Enum.Font.Gotham
    descLabel.TextSize = 12
    descLabel.TextXAlignment = Enum.TextXAlignment.Left
    descLabel.Parent = buttonFrame
    
    button.MouseButton1Click:Connect(callback)
    
    return buttonFrame
end

-- Create all MM2 feature buttons
createButton("💥 CRASH ALL PLAYERS", "Instantly crash everyone in the server", crashAllPlayers, Color3.fromRGB(255, 50, 50))
createButton("🔒 HOSTAGE ALL PLAYERS", "Teleport everyone to your position", hostageAllPlayers, Color3.fromRGB(255, 150, 50))
createButton("❄️ FREEZE ALL PLAYERS", "Freeze everyone in place", freezeAllPlayers, Color3.fromRGB(50, 150, 255))
createButton("🔥 UNFREEZE ALL PLAYERS", "Unfreeze everyone", unfreezeAllPlayers, Color3.fromRGB(50, 255, 150))
createButton("🔪 FREEZE MURDERER IN FRONT", "Freeze murderer and bring them to you", freezeMurdererInFront, Color3.fromRGB(255, 50, 150))
createButton("📋 COPY MURDERER NAME", "Copy murderer's username to clipboard", function()
    local name = copyMurdererName()
    if name then
        -- Show success message
        local notif = Instance.new("TextLabel")
        notif.Size = UDim2.new(0, 200, 0, 40)
        notif.Position = UDim2.new(0.5, -100, 0.9, 0)
        notif.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
        notif.Text = "✅ Copied: " .. name
        notif.TextColor3 = Color3.new(1, 1, 1)
        notif.Font = Enum.Font.GothamBold
        notif.TextSize = 14
        notif.Parent = mm2HubGui
        
        local notifCorner = Instance.new("UICorner")
        notifCorner.CornerRadius = UDim.new(0, 8)
        notifCorner.Parent = notif
        
        task.wait(3)
        notif:Destroy()
    end
end, Color3.fromRGB(255, 100, 200))
createButton("👮 COPY SHERIFF NAME", "Copy sheriff's username to clipboard", function()
    local name = copySheriffName()
    if name then
        local notif = Instance.new("TextLabel")
        notif.Size = UDim2.new(0, 200, 0, 40)
        notif.Position = UDim2.new(0.5, -100, 0.9, 0)
        notif.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
        notif.Text = "✅ Copied: " .. (name or "None")
        notif.TextColor3 = Color3.new(1, 1, 1)
        notif.Font = Enum.Font.GothamBold
        notif.TextSize = 14
        notif.Parent = mm2HubGui
        
        local notifCorner = Instance.new("UICorner")
        notifCorner.CornerRadius = UDim.new(0, 8)
        notifCorner.Parent = notif
        
        task.wait(3)
        notif:Destroy()
    end
end, Color3.fromRGB(100, 150, 255))

-- Discord button in main hub too
createButton("📢 JOIN DISCORD SERVER", "Get support, updates, and more keys", function()
    pcall(function()
        setclipboard("https://discord.gg/9BDbbzWQKV")
    end)
    
    -- Show success message
    local notif = Instance.new("TextLabel")
    notif.Size = UDim2.new(0, 250, 0, 40)
    notif.Position = UDim2.new(0.5, -125, 0.9, 0)
    notif.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    notif.Text = "✅ Discord link copied to clipboard!"
    notif.TextColor3 = Color3.new(1, 1, 1)
    notif.Font = Enum.Font.GothamBold
    notif.TextSize = 14
    notif.Parent = mm2HubGui
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 8)
    notifCorner.Parent = notif
    
    task.wait(3)
    notif:Destroy()
end, Color3.fromRGB(88, 101, 242))

-- Close button
createButton("❌ CLOSE HUB", "Close the MM2 Hub interface", function()
    mm2HubGui:Destroy()
end, Color3.fromRGB(100, 100, 100))

-- Auto-update UIListLayout
uiListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, uiListLayout.AbsoluteContentSize.Y + 20)
end)

-- Make window draggable
local dragging = false
local dragInput, dragStart, startPos

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Success notification
local successNotif = Instance.new("TextLabel")
successNotif.Size = UDim2.new(0, 300, 0, 50)
successNotif.Position = UDim2.new(0.5, -150, 0.1, 0)
successNotif.BackgroundColor3 = Color3.fromRGB(50, 255, 50)
successNotif.Text = "✅ MM2 Hub Loaded Successfully!"
successNotif.TextColor3 = Color3.new(1, 1, 1)
successNotif.Font = Enum.Font.GothamBold
successNotif.TextSize = 16
successNotif.Parent = mm2HubGui

local successCorner = Instance.new("UICorner")
successCorner.CornerRadius = UDim.new(0, 8)
successCorner.Parent = successNotif

task.wait(3)
successNotif:Destroy()

print("MM2 Hub loaded successfully!")
